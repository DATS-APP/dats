<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DATS — Dashboard</title>

  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 32 32%22><text y=%2224%22 font-size=%2232%22>☁️</text></svg>">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link href="assets/css/app.css" rel="stylesheet">
  <style>
    #dashboardMap { height: 450px; border-radius:10px; margin-top:20px; }
    .badge-safe { background-color: #28a745; color: #fff; }
    .badge-moderate { background-color: #ffc107; color: #000; }
    .badge-risk { background-color: #dc3545; color: #fff; }
    .alert-card:hover { transform: scale(1.02); transition:0.2s; }
    .modal-content { color: #000; }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
    <div class="container">
      <a class="navbar-brand" href="index.html">DATS</a>
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a></li>
        <li class="nav-item"><a class="nav-link" href="safety.html">Safety</a></li>
        <li class="nav-item"><a class="nav-link" href="routes.html">Routes</a></li>
      </ul>
    </div>
  </nav>

  <div class="container my-4">
    <h2 class="fw-bold text-center">Dashboard</h2>

    <!-- Live Alerts Section -->
    <div class="card p-3 my-3">
      <h5>Live Alerts (City & Severity)</h5>
      <div id="live-alerts-dashboard" class="row g-3"></div>
    </div>

    <!-- Map -->
    <div id="dashboardMap"></div>
  </div>

  <!-- Alert Modal -->
  <div class="modal fade" id="dashboardAlertModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content p-3">
        <h5 class="fw-bold" id="dash-modal-alert-name">Alert Name</h5>
        <p><strong>Severity:</strong> <span id="dash-modal-alert-severity"></span></p>
        <p><strong>Location:</strong> <span id="dash-modal-alert-location"></span></p>
        <p id="dash-modal-alert-description">Suggested action / description goes here.</p>
        <button class="btn btn-dark" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>

  <!-- Hidden alert template -->
  <div id="alert-card-template-dashboard" class="col-md-4" style="display:none;">
    <div class="card p-3 alert-card h-100">
      <h6 class="alert-name fw-bold"></h6>
      <p class="muted"><span class="alert-severity"></span></p>
      <button class="btn btn-sm btn-primary more-info-btn" data-bs-toggle="modal" data-bs-target="#dashboardAlertModal">More Info</button>
    </div>
  </div>

  <!-- Footer -->
  <footer class="text-center py-3">© 2025 DATS</footer>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const liveAlerts = [
      { name:"Flood Warning", severity:"Risk", coords:[28.65,77.20], location:"Delhi", description:"Avoid low-lying areas. Follow official evacuation instructions." },
      { name:"Storm Alert", severity:"Moderate", coords:[19.07,72.88], location:"Mumbai", description:"Travel may be delayed. Take caution while commuting." },
      { name:"Traffic Delay", severity:"Moderate", coords:[12.97,77.59], location:"Bangalore", description:"Heavy traffic reported. Consider alternate routes." },
      { name:"Heat Wave", severity:"Moderate", coords:[13.08,80.27], location:"Chennai", description:"Stay hydrated and avoid outdoor travel during peak hours." },
      { name:"Cyclone Warning", severity:"Risk", coords:[22.57,88.36], location:"Kolkata", description:"Seek shelter and avoid coastal regions until warning is lifted." }
    ];

    const dashboardMap = L.map('dashboardMap').setView([20.5937,78.9629],5);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(dashboardMap);
    let alertLayer = L.layerGroup().addTo(dashboardMap);

    const container = document.getElementById('live-alerts-dashboard');
    const template = document.getElementById('alert-card-template-dashboard');

    liveAlerts.forEach(alert => {
      const card = template.cloneNode(true);
      card.style.display = 'block';
      card.querySelector('.alert-name').textContent = alert.name + " — " + alert.location;
      card.querySelector('.alert-severity').textContent = alert.severity;

      const btn = card.querySelector('.more-info-btn');
      btn.addEventListener('click', () => {
        document.getElementById('dash-modal-alert-name').textContent = alert.name;
        document.getElementById('dash-modal-alert-severity').textContent = alert.severity;
        document.getElementById('dash-modal-alert-location').textContent = alert.location;
        document.getElementById('dash-modal-alert-description').textContent = alert.description;
      });

      container.appendChild(card);

      const color = alert.severity === "Safe" ? "green" : alert.severity === "Moderate" ? "orange" : "red";
      L.circleMarker(alert.coords, { radius:8, color:color, fillColor:color, fillOpacity:0.7 })
        .addTo(alertLayer)
        .bindPopup(`<strong>${alert.name}</strong><br>Severity: ${alert.severity}<br>Location: ${alert.location}`);
    });
  </script>
</body>
</html>
