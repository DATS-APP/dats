<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DATS — Safety</title>

  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 32 32%22><text y=%2224%22 font-size=%2232%22>☁️</text></svg>">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link href="assets/css/app.css" rel="stylesheet">
  <style>
    #safetyMap { height: 450px; border-radius:10px; margin-top:20px; }
    .badge-safe { background-color: #28a745; color: #fff; }
    .badge-moderate { background-color: #ffc107; color: #000; }
    .badge-risk { background-color: #dc3545; color: #fff; }
    .alert-card { cursor: pointer; transition:0.2s; }
    .alert-card:hover { transform: scale(1.02); }
  </style>
</head>
<body>
  <!-- Navbar for Safety & Routes pages -->
<nav class="navbar navbar-dark bg-dark sticky-top">
  <div class="container">
    <a class="navbar-brand" href="index.html">DATS</a>
    <ul class="navbar-nav ms-auto d-flex flex-row">
      <li class="nav-item mx-2"><a class="nav-link" href="dashboard.html">Dashboard</a></li>
      <li class="nav-item mx-2"><a class="nav-link" href="safety.html">Safety</a></li>
      <li class="nav-item mx-2"><a class="nav-link" href="routes.html">Routes</a></li>
    </ul>
  </div>
</nav>

  <div class="container my-4">
    <h2 class="fw-bold text-center">Safety Checker</h2>

    <div class="card p-3 my-3">
      <div class="row g-2 align-items-center">
        <div class="col-md-6">
          <label class="form-label">Select City</label>
          <select id="citySelect" class="form-select">
            <option value="">Choose a city</option>
            <option value="Delhi">Delhi</option>
            <option value="Mumbai">Mumbai</option>
            <option value="Bangalore">Bangalore</option>
            <option value="Chennai">Chennai</option>
            <option value="Kolkata">Kolkata</option>
          </select>
        </div>
        <div class="col-md-6 d-grid">
          <label class="form-label">&nbsp;</label>
          <button id="checkSafety" class="btn btn-primary">Check Safety</button>
        </div>
      </div>
    </div>

    <div id="safetyProgress" class="my-3"></div>
    <div id="alertList" class="row g-3"></div>
    <div id="safetyMap"></div>
  </div>

  <footer class="text-center py-3">© 2025 DATS</footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const cityCoords = {
      "Delhi":[28.6139,77.2090],
      "Mumbai":[19.0760,72.8777],
      "Bangalore":[12.9716,77.5946],
      "Chennai":[13.0827,80.2707],
      "Kolkata":[22.5726,88.3639]
    };

    const mockAlerts = {
      "Delhi":[
        {name:"Flood Warning", severity:"Risk", coords:[28.65,77.20], cause:"Heavy rain causing water logging in low areas", action:"Avoid low-lying areas; follow traffic advisories."},
        {name:"Air Pollution", severity:"Moderate", coords:[28.61,77.21], cause:"High PM2.5 levels", action:"Limit outdoor activities; wear masks."}
      ],
      "Mumbai":[
        {name:"Storm Alert", severity:"Moderate", coords:[19.07,72.88], cause:"Thunderstorms predicted", action:"Stay indoors; avoid coastal areas."},
        {name:"Water Logging", severity:"Risk", coords:[19.08,72.87], cause:"Heavy rain in low-lying areas", action:"Avoid streets near rivers; use alternate routes."}
      ],
      "Bangalore":[
        {name:"Traffic Delay", severity:"Moderate", coords:[12.97,77.59], cause:"Construction work on main roads", action:"Use alternate routes; expect delays."}
      ],
      "Chennai":[
        {name:"Heat Wave", severity:"Moderate", coords:[13.08,80.27], cause:"Temperature above 40°C", action:"Stay hydrated; avoid direct sun exposure."}
      ],
      "Kolkata":[
        {name:"Cyclone Warning", severity:"Risk", coords:[22.57,88.36], cause:"Cyclone approaching coast", action:"Follow evacuation orders; avoid traveling."}
      ]
    };

    const safetyMap = L.map('safetyMap').setView([20.5937,78.9629],5);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(safetyMap);

    let alertLayer = L.layerGroup().addTo(safetyMap);

    document.getElementById('checkSafety').addEventListener('click',()=>{
      const city = document.getElementById('citySelect').value;
      if(!city) return alert('Please select a city.');

      const progress = document.getElementById('safetyProgress');
      progress.innerHTML='<div class="progress-box">Fetching safety alerts…</div>';

      setTimeout(()=>{
        progress.innerHTML='';
        alertLayer.clearLayers();
        const alerts = mockAlerts[city] || [];

        const alertListDiv = document.getElementById('alertList');
        alertListDiv.innerHTML='';

        alerts.forEach(alert=>{
          const color = alert.severity==='Safe'?'green':alert.severity==='Moderate'?'orange':'red';

          // Add marker
          const marker = L.circleMarker(alert.coords,{
            radius:8,color:color,fillColor:color,fillOpacity:0.7
          }).addTo(alertLayer);

          // Bind popup with detailed info
          marker.bindPopup(`<strong>${alert.name}</strong><br>
                            Severity: ${alert.severity}<br>
                            Cause: ${alert.cause}<br>
                            Recommended: ${alert.action}`);

          // Add card to list
          const card = document.createElement('div');
          card.className='col-12 col-md-6';
          card.innerHTML=`<div class="card alert-card p-3">
                            <h6>${alert.name} <span class="${alert.severity==='Safe'?'badge-safe':alert.severity==='Moderate'?'badge-moderate':'badge-risk'}">${alert.severity}</span></h6>
                            <p class="muted"><strong>Cause:</strong> ${alert.cause}</p>
                            <p class="muted"><strong>Recommended:</strong> ${alert.action}</p>
                          </div>`;
          alertListDiv.appendChild(card);

          // Click card zooms map to marker
          card.querySelector('div').addEventListener('click',()=>{safetyMap.setView(alert.coords,13); marker.openPopup();});
        });

        // Center map on city
        safetyMap.setView(cityCoords[city], 12);
        L.marker(cityCoords[city]).addTo(alertLayer).bindPopup(`<strong>${city}</strong>`).openPopup();
      },500);
    });
  </script>
</body>
</html>
