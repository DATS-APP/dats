<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>SafeTravel — Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Manrope:wght@600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/css/app.css" rel="stylesheet">
</head>
<body class="app-bg">
  <div class="app-layout">
    <aside class="app-sidebar d-none d-lg-flex flex-column">
      <div class="p-3 d-flex align-items-center gap-2">
        <svg width="28" height="28" viewBox="0 0 32 32" aria-hidden="true">
          <defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-color="#0d6efd"/><stop offset="1" stop-color="#198754"/></linearGradient></defs>
          <rect x="2" y="2" width="28" height="28" rx="8" fill="url(#g)" opacity="0.2"></rect>
          <path d="M8 16c0-4.4 3.6-8 8-8s8 3.6 8 8-3.6 8-8 8" fill="url(#g)"></path>
          <path d="M16 10v12" stroke="#0d6efd" stroke-width="2" stroke-linecap="round"></path>
        </svg>
        <span class="fw-semibold">SafeTravel</span>
      </div>
      <nav class="nav flex-column px-2">
        <a class="nav-link" href="index.html"><i class="bi bi-house"></i> Home</a>
        <a class="nav-link" href="safety.html"><i class="bi bi-shield-check"></i> Safety</a>
        <a class="nav-link active" href="dashboard.html"><i class="bi bi-activity"></i> Dashboard</a>
        <a class="nav-link" href="routes.html"><i class="bi bi-signpost-2"></i> Routes</a>
        <div class="border-top my-2"></div>
        <a class="nav-link" href="about.html"><i class="bi bi-info-circle"></i> About</a>
        <a class="nav-link" href="contact.html"><i class="bi bi-people"></i> Contact</a>
      </nav>
      <div class="mt-auto p-3 small text-muted">
        <button id="theme-toggle" class="btn btn-soft w-100">Toggle Theme</button>
      </div>
    </aside>
    <main class="app-main">
      <section class="container-fluid py-3">
        <div class="row g-3">
          <div class="col-lg-8">
            <div class="card card-glass">
              <div class="card-header bg-transparent d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center gap-2">
                  <i class="bi bi-activity"></i>
                  <span>Live Disaster Map</span>
                </div>
                <div class="d-flex gap-2">
                  <select id="layer" class="form-select form-select-sm">
                    <option value="all">All</option>
                    <option value="flood">Floods</option>
                    <option value="cyclone">Cyclones</option>
                    <option value="earthquake">Earthquakes</option>
                    <option value="wildfire">Wildfires</option>
                  </select>
                  <button id="refresh" class="btn btn-soft btn-sm"><i class="bi bi-arrow-clockwise"></i></button>
                </div>
              </div>
              <div class="card-body p-0">
                <div id="map" class="map"></div>
              </div>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="card card-frost h-100">
              <div class="card-header bg-transparent">Live Alerts</div>
              <div class="card-body p-0">
                <ul id="feed" class="list-group list-group-flush small"></ul>
                <div id="feed-empty" class="p-4 text-center text-muted">No alerts for this filter.</div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1080">
        <div id="app-toast" class="toast align-items-center text-bg-dark border-0" role="alert">
          <div class="d-flex">
            <div class="toast-body" id="toast-body">Action completed</div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
          </div>
        </div>
      </div>
    </main>
    <nav class="app-tabbar d-lg-none">
      <a href="index.html" class="tab"><i class="bi bi-house"></i><span>Home</span></a>
      <a href="safety.html" class="tab"><i class="bi bi-shield-check"></i><span>Safety</span></a>
      <a href="dashboard.html" class="tab"><i class="bi bi-activity"></i><span>Live</span></a>
      <a href="routes.html" class="tab"><i class="bi bi-signpost-2"></i><span>Routes</span></a>
    </nav>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/app.js"></script>
  <script src="assets/js/api.js"></script>
  <script src="assets/js/map.js"></script>
  <script>
  (async function(){
    await window.maps.ensure();
    await window.maps.initMap('map', { lat: 20.5937, lng: 78.9629 }, 5);
    const layerSel = document.getElementById('layer');
    const feed = document.getElementById('feed');
    const empty = document.getElementById('feed-empty');
    const load = async () => {
      const layer = layerSel.value;
      const alerts = await window.api.getLiveAlerts(layer);
      window.maps.setMarkers(alerts.map(a => ({
        position: { lat: a.lat, lng: a.lng },
        title: `${a.type} • ${a.severity}`,
        icon: window.maps.iconFor(a.type)
      })));
      feed.innerHTML = '';
      if (!alerts.length) {
        empty.style.display = 'block';
      } else {
        empty.style.display = 'none';
        alerts.forEach(a=>{
          const li = document.createElement('li');
          li.className = 'list-group-item d-flex justify-content-between align-items-center';
          li.innerHTML = `<span><span class="dot ${a.type.toLowerCase()}"></span>${a.type} • ${a.severity}</span><small class="text-muted">${new Date(a.time).toLocaleString()}</small>`;
          feed.appendChild(li);
        });
      }
    };
    document.getElementById('refresh').onclick = load;
    layerSel.onchange = load;
    load();
  })();
  </script>
</body>
</html>
